<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mapa de Desastres Â· ODS 13</title>

  <!-- Leaflet core -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- MarkerCluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">
  <script defer src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <!-- Chart.js para las grÃ¡ficas -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="stylesheet" href="styles/ui.css" />
</head>
<body>
  <header class="app-header" role="banner">
    <div class="container head-wrap" >
      <div class="brand" aria-label="Mapa de Desastres">
        <div class="logo" aria-hidden="true">ðŸŒŽ</div>
        <div class="brand-txt">
          <h1>Mapa de Desastres</h1>
          <p class="muted">ODS 13 Â· AcciÃ³n por el clima â€” Reportes en tiempo real</p>
        </div>
      </div>
      <nav class="actions" aria-label="Acciones">
        <button id="btnFilters" class="btn" aria-controls="filtersPanel" aria-expanded="false" aria-label="Abrir filtros">Filtros</button>
        <button id="btnNuevo" class="btn primary" aria-haspopup="dialog" aria-controls="dlgNuevo">ï¼‹ Nuevo reporte</button>
      </nav>
    </div>
  </header>

  <aside id="filtersPanel" class="filters" aria-hidden="true">
    <div class="content" role="region" aria-label="Panel de filtros">
      <h2>Filtrar visualizaciÃ³n</h2>

      <hr style="margin:12px 0;border:none;border-top:1px solid var(--border)" />
      <h3 style="margin:0 0 8px 0;font-size:16px">Recomendaciones</h3>
      <div id="recomBox" class="card" style="border-radius:12px;margin-top:8px">
        <div class="content" id="recomContent"></div>
      </div>

      <div class="field">
        <label for="fSearch">BÃºsqueda</label>
        <input id="fSearch" type="search" placeholder="palabra, fuente, descripciÃ³n" autocomplete="off" />
      </div>

      <div class="field">
        <label for="fTipo">Tipo de evento</label>
        <select id="fTipo">
          <option value="todos">Todos</option>
        </select>
      </div>

      <div class="field">
        <label for="fSev">Severidad</label>
        <select id="fSev">
          <option value="todas">Todas</option>
          <option value="baja">Baja</option>
          <option value="media">Media</option>
          <option value="alta">Alta</option>
        </select>
      </div>

      <div class="row">
        <div class="field">
          <label for="fFrom">Desde</label>
          <input id="fFrom" type="date" />
        </div>
        <div class="field">
          <label for="fTo">Hasta</label>
          <input id="fTo" type="date" />
        </div>
      </div>

      <div class="field">
        <label for="fFuente">Fuente</label>
        <select id="fFuente">
          <option value="todas">Todas</option>
          <option value="CiudadanÃ­a">CiudadanÃ­a</option>
          <option value="ProtecciÃ³n Civil">ProtecciÃ³n Civil</option>
          <option value="EstaciÃ³n Metereologica">EstaciÃ³n MetereolÃ³gica</option>
        </select>
      </div>

      <div class="actions-inline">
        <button id="btnClear" class="btn">Limpiar</button>
        <button id="btnCloseFilters" class="btn">Cerrar panel</button>
      </div>

      <div class="legend">
        <p class="legend-title">Leyenda de severidad</p>
        <div class="legend-row"><span class="dot" style="background:#22c55e"></span><span class="small">Baja</span></div>
        <div class="legend-row"><span class="dot" style="background:#eab308"></span><span class="small">Media</span></div>
        <div class="legend-row"><span class="dot" style="background:#ef4444"></span><span class="small">Alta</span></div>
      </div>
    </div>
  </aside>

  <main class="container app-main">
    <!-- Indicadores -->
    <section class="card">
      <h3>Indicadores</h3>
      <div class="content">
        <div class="kpis">
          <div class="kpi">
            <div class="label">Eventos (filtro)</div>
            <div id="kTotal" class="value">0</div>
          </div>
          <div class="kpi">
            <div class="label">Ãšltimas 24 h</div>
            <div id="k24" class="value">0</div>
          </div>
          <div class="kpi">
            <div class="label">Tipos activos</div>
            <div id="kTipos" class="value">0</div>
          </div>
        </div>
      </div>
    </section>

    <!-- NUEVA SECCIÃ“N: GRÃFICAS -->
    <section class="card">
      <h3>GrÃ¡ficas de incidentes</h3>
      <div class="content">
        <h4>Incidentes por tipo</h4>
        <canvas id="chartTipos"></canvas>

        <h4>Incidentes por severidad</h4>
        <canvas id="chartSeveridad"></canvas>

        <h4>Incidentes por mes</h4>
        <canvas id="chartMeses"></canvas>
      </div>
    </section>

    <!-- DistribuciÃ³n por tipo -->
    <section class="card">
      <h3>DistribuciÃ³n por tipo</h3>
      <div class="content">
        <div id="badgesTipos" class="badges" role="list"></div>
      </div>
    </section>

    <!-- Lista de reportes -->
    <section class="card">
      <h3>Reportes</h3>
      <div id="list" class="list" role="list"></div>
    </section>

    <!-- Mapa -->
    <section class="card full">
      <h3>Mapa interactivo</h3>
      <div id="map" aria-label="Mapa principal" role="application"></div>
    </section>
  </main>

  <footer class="container small">
    Proyecto acadÃ©mico Â· ODS 13 Â· Stack: HTML Â· CSS Â· JavaScript Â· Leaflet Â· (API R/MongoDB a integrar) .
    HERRAMIENTAS PARA DATOS NO ESTRUCTURADOS
  </footer>

  <!-- DiÃ¡logo nuevo -->  
  <dialog id="dlgNuevo" aria-labelledby="dlgTitle">
    <div class="dialog-head">
      <h2 id="dlgTitle">Registrar evento</h2>
      <button id="btnCloseDlg" class="btn" aria-label="Cerrar">Cerrar</button>
    </div>
    <form id="formNuevo" class="dialog-body" method="dialog">
      <div class="grid-2">
        <div class="field col-span">
          <label for="nDesc">DescripciÃ³n <span class="req">*</span></label>
          <textarea id="nDesc" rows="3" placeholder="Â¿QuÃ© ocurre? Da contexto breve." required minlength="10" maxlength="240"></textarea>
          <small class="hint" id="hintDesc">Entre 10 y 240 caracteres.</small>
        </div>
        <div class="field">
          <label for="nTipo">Tipo</label>
          <select id="nTipo"></select>
        </div>
        <div class="field">
          <label for="nSev">Severidad</label>
          <select id="nSev">
            <option value="baja">Baja</option>
            <option value="media" selected>Media</option>
            <option value="alta">Alta</option>
          </select>
        </div>
        <div class="field col-span">
          <label for="nFuente">Fuente</label>
          <input id="nFuente" placeholder="CiudadanÃ­a, PC Municipal, EstaciÃ³n Meteoâ€¦"/>
        </div>
        <p class="small col-span">Haz clic en el mapa mini para fijar la ubicaciÃ³n. <span id="nCoord">Sin coordenadas</span></p>
        <div class="map-mini col-span" id="mapMini" aria-label="Mapa para elegir ubicaciÃ³n"></div>
        <div class="col-span actions-inline end">
          <button class="btn" id="btnCancel" type="button">Cancelar</button>
          <button class="btn primary" id="btnSave" type="submit" disabled>Guardar reporte</button>
        </div>
      </div>
    </form>
  </dialog>

  <script>
    window.USE_API = true;
    window.API_BASE = "http://localhost:3000/api";
    window.FEATURES = { uploads:false, riskLayer:false, captcha:false };
  </script>

  <script type="module" src="js/app.js"></script>
</body>
</html>
